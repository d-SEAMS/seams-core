<!-- Copyright 2020 Rohit Goswami <rog32@hi.is>
     Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at
     http://www.apache.org/licenses/LICENSE-2.0
     Unless required by applicable law or agreed to in writing, software
     distributed under the License is distributed on an "AS IS" BASIS,
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License. -->
<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>d-SEAMS: d-SEAMS</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  },
  svg: {
    fontCache: 'global'
  }
  loader: { load: ["[tex]/unicode", "[tex]/ams"] },
  tex: {
    packages: { "[+]": ["unicode", "ams"] },
    tags: "ams",
  },
};
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>
<!-- <link href="doxygen.css" rel="stylesheet" type="text/css" /> -->
<link href="doxyYoda.min.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" >
$(document).ready(function() {
     $(".fragment").wrap("<details class='code-details'></details>");
     $(".code-details").append("<summary>Code</summary>");
 }
)
</script>
</head>
<body>
<div class="grid-contents">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<nav class="title_area">
<a class="project_logo" href="#">
<img src="dSeamsLogo.png" width="30" height="30" alt="Logo">
</a>
<span class="project_info">d-SEAMS v1.0.0</span>
</nav>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">d-SEAMS </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The C++ core of d-SEAMS, a molecular dynamics trajectory analysis engine. <a class="anchor" id="md_README"></a> <b>Deferred Structural Elucidation Analysis for Molecular Simulations</b></p>
<p><a href="https://github.com/d-SEAMS/seams-core/actions/workflows/build_pkg.yml"><img src="https://github.com/d-SEAMS/seams-core/actions/workflows/build_pkg.yml/badge.svg" alt="Build Status" style="pointer-events: none;" class="inline"/></a></p>
<p><a href="https://builtwithnix.org"><img src="https://builtwithnix.org/badge.svg" alt="built with nix" style="pointer-events: none;" class="inline"/></a></p>
<ul>
<li>Check our build status <a href="https://github.com/d-SEAMS/seams-core/actions/workflows/">here</a>.</li>
<li>The docs themselves are <a href="https://docs.dseams.info">here</a> and development is ongoing <a href="https://github.com/d-SEAMS/seams-core">on GitHub</a></li>
<li>We also have <a href="https://zenodo.org/communities/d-seams/">a Zenodo community</a> for user-contributions like reviews, testimonials and tutorials</li>
<li>Trajectories are hosted <a href="https://figshare.com/projects/d-SEAMS_Datasets/73545">on figshare</a>.</li>
<li>Our <a href="https://wiki.dseams.info">wiki is here</a></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The <a href="pages.html">related pages</a> describe the examples and how to obtain the data-sets (trajectories) <a href="https://figshare.com/projects/d-SEAMS_Datasets/73545">from figshare</a>.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd><b>If</b> you are unwilling to use the <code>nix</code> build system, then <b>please note</b> that you must manage the dependencies MANUALLY, including the compiler versions. Optionally, use the provided <code>conda</code> environment.</dd></dl>
<h1>Citation</h1>
<ul>
<li>This has been published at the <a href="https://doi.org/10.1021/acs.jcim.0c00031">Journal of Chemical Information and Modeling (JCIM)</a></li>
<li>You may also read <a href="https://arxiv.org/abs/1909.09830">the preprint on arXiv</a></li>
</ul>
<p>If you use this software please cite the following: </p><pre class="fragment">Goswami, R., Goswami, A., &amp; Singh, J. K. (2020). d-SEAMS: Deferred Structural Elucidation Analysis for Molecular Simulations. Journal of Chemical Information and Modeling. https://doi.org/10.1021/acs.jcim.0c00031
</pre><p> The corresponding <code>bibtex</code> entry is: </p><pre class="fragment">@Article{Goswami2020,
author={Goswami, Rohit and Goswami, Amrita and Singh, Jayant Kumar},
title={d-SEAMS: Deferred Structural Elucidation Analysis for Molecular Simulations},
journal={Journal of Chemical Information and Modeling},
year={2020},
month={Mar},
day={20},
publisher={American Chemical Society},
issn={1549-9596},
doi={10.1021/acs.jcim.0c00031},
url={https://doi.org/10.1021/acs.jcim.0c00031}
}
</pre> <h1>Compilation</h1>
<p>We use a deterministic build system to generate both bug reports and uniform usage statistics. This also handles the <code>lua</code> scripting engine.</p>
<dl class="section note"><dt>Note</dt><dd>The lua functions are documented on the <a href="https://docs.dseams.info/md_markdown_luafunctions">on the API Docs</a></dd></dl>
<p>We also provide a <code>conda</code> environment as a fallback, which is also recommended for MacOS users.</p>
<h2>Build</h2>
<h3>Conda</h3>
<p>Although we strongly suggest using <code>nix</code>, for MacOS systems, the following instructions may be more suitable. We will assume the presence of <a href="https://mamba.readthedocs.io/en/latest/installation.html">micromamba</a>:</p>
<div class="fragment"><div class="line">micromamba create -f environment.yml</div>
<div class="line">micromamba activate dseams</div>
</div><!-- fragment --><p>Now the installation can proceed.</p>
<dl class="section note"><dt>Note</dt><dd>we do not install a new version of <code>cmake</code> within the <code>conda</code> environment because of conflicts with <code>lua</code></dd></dl>
<div class="fragment"><div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_EXPORT_COMPILE_COMMANDS=YES -DCMAKE_INSTALL_PREFIX:PATH=$CONDA_PREFIX ../</div>
<div class="line">make -j$(nproc)</div>
<div class="line">make install</div>
</div><!-- fragment --><p>We have opted to install into the <code>conda</code> environment, if this is not the intended behavior, use <code>/usr/local</code> instead.</p>
<h3>Spack</h3>
<p>Manually this can be done in a painful way as follows:</p>
<div class="fragment"><div class="line">spack install eigen@3.3.9 lua@5.2</div>
<div class="line">spack install catch2 fmt yaml-cpp openblas boost cmake ninja meson</div>
<div class="line">spack load catch2 fmt yaml-cpp openblas boost cmake ninja meson eigen@3.3.9 lua@5.2</div>
<div class="line">luarocks install luafilesystem</div>
</div><!-- fragment --><p>Or better:</p>
<div class="fragment"><div class="line">spack env activate $(pwd)</div>
<div class="line"># After loading the packages</div>
<div class="line">luarocks install luafilesystem</div>
</div><!-- fragment --><p>Now we can build and install as usual.</p>
<div class="fragment"><div class="line">cmake -S . -B build -DCMAKE_BUILD_TYPE=RelWithDebInfo \</div>
<div class="line"> -DCMAKE_EXPORT_COMPILE_COMMANDS=YES -GNinja \</div>
<div class="line"> -DCMAKE_INSTALL_PREFIX=$HOME/.local \</div>
<div class="line"> -DCMAKE_CXX_FLAGS=&quot;-pg -fsanitize=address &quot; \</div>
<div class="line"> -DCMAKE_EXE_LINKER_FLAGS=-pg -DCMAKE_SHARED_LINKER_FLAGS=-pg \</div>
<div class="line"> -DBUILD_TESTING=NO</div>
<div class="line">cmake --build build</div>
</div><!-- fragment --><p>Or more reasonably:</p>
<div class="fragment"><div class="line">export INST_DIR=$HOME/.local</div>
<div class="line">cd src</div>
<div class="line">meson setup bbdir --prefix $INST_DIR</div>
<div class="line">meson compile -C bbdir</div>
<div class="line">meson install -C bbdir</div>
<div class="line"># if not done</div>
<div class="line">export PATH=$PATH:$INST_DIR/bin</div>
<div class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$INST_DIR/lib</div>
<div class="line">cd ../</div>
<div class="line">yodaStruct -c lua_inputs/config.yml</div>
</div><!-- fragment --><h3>Nix</h3>
<p>Since this project is built with <code>nix</code>, we can simply do the following from the root directory (longer method):</p>
<div class="fragment"><div class="line"># Make sure there are no artifacts</div>
<div class="line">rm -rf build</div>
<div class="line"># This will take a long time the first time as it builds the dependencies</div>
<div class="line">nix-build . # Optional</div>
<div class="line"># Install into your path</div>
<div class="line">nix-env -if . # Required</div>
<div class="line"># Run the command anywhere</div>
<div class="line">yodaStruct -c lua_inputs/config.yml</div>
</div><!-- fragment --><p>A faster method of building the software is by using the <a href="https://dseams.cachix.org/">cachix binary cache</a> as shown:</p>
<div class="fragment"><div class="line"># Install cachix</div>
<div class="line">nix-env -iA cachix -f https://cachix.org/api/v1/install</div>
<div class="line"># Use the binary cache</div>
<div class="line">cachix use dseams</div>
<div class="line"># Faster with the cache than building from scratch</div>
<div class="line">nix-build . # Optional</div>
<div class="line"># Install into your path</div>
<div class="line">nix-env -if . # Required</div>
<div class="line"># Run the command anywhere</div>
<div class="line">yodaStruct -c lua_inputs/config.yml</div>
</div><!-- fragment --><h3>Usage</h3>
<p>Having installed the <code>yodaStruct</code> binary and library, we can now use it.</p>
<div class="fragment"><div class="line">yodaStruct -c lua_inputs/config.yml</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The paths in the <code>.yml</code> should be <b>relative to the folder from which the binary is called</b>.</dd></dl>
<p>If you're confused about how to handle the relative paths, run the command <code>yodaStruct -c lua_inputs/config.yml</code> in the top-level directory, and set the paths relative to the top-level directory. This is the convention used in the examples as well.</p>
<h3>Language Server Support</h3>
<p>To generate a <code>compile_commands.json</code> file for working with a language server like <a href="https://github.com/MaskRay/ccls">ccls</a> use the following commands:</p>
<div class="fragment"><div class="line"># Pure environment</div>
<div class="line">nix-shell --pure</div>
<div class="line">mkdir -p build &amp;&amp; cd build</div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=YES ../</div>
<div class="line">cp compile_commands.json ../</div>
</div><!-- fragment --><p>Note that there is no need to actually compile the project if you simply need to get the compiler database for the language server.</p>
<p><b>Do Not</b> commit the <code>.json</code> file.</p>
<h2>Development</h2>
<p>We can simply use the <code>nix</code> environment:</p>
<div class="fragment"><div class="line"># From the project root</div>
<div class="line">nix-shell --pure</div>
</div><!-- fragment --><h1>Running</h1>
<p>This is built completely with nix:</p>
<div class="fragment"><div class="line"># Install systemwide</div>
<div class="line">nix-env -if .</div>
</div><!-- fragment --><p>To run the sample inputs, simply install the software, and ensure that <code>input/</code> is a child directory.</p>
<div class="fragment"><div class="line"># Assuming you are in the src directory</div>
<div class="line"># Check help with -h</div>
<div class="line">yodaStruct -c lua_inputs/config.yml</div>
</div><!-- fragment --><h2>Tests</h2>
<p>Apart from the <a href="https://docs.dseams.info/pages.html">examples</a>, the test-suite can be run with the <code>yodaStruct_test</code> binary, which will drop into the <code>nix</code> environment before building and executing <code>gdb</code>:</p>
<div class="fragment"><div class="line"># Just run this</div>
<div class="line">./testBuild.sh</div>
<div class="line"># At this point the binary and library are copied into the root</div>
<div class="line"># One might, in a foolhardy attempt, use gdb at this point</div>
<div class="line"># Here be dragons :)</div>
<div class="line"># USE NIX</div>
<div class="line"># Anyway</div>
<div class="line">gdb --args ./yodaStruct -c lua_inputs/config.yml</div>
<div class="line"># quit gdb with quit</div>
<div class="line"># Go run the test binary</div>
<div class="line">cd shellBuild</div>
<div class="line">./yodaStruct_test</div>
</div><!-- fragment --><p>Do note that the regular installation via <code>nix-env</code> runs the tests before the installation</p>
<h1>Developer Documentation</h1>
<p>While developing, it is sometimes expedient to update the packages used. It is then useful to note that we use <a href="https://github.com/nmattia/niv/">niv</a> to handle our pinned packages (apart from the ones built from Github). Thus, one might need, say:</p>
<div class="fragment"><div class="line">niv update nixpkgs -b nixpkgs-unstable</div>
</div><!-- fragment --><p>Test the build with nix:</p>
<div class="fragment"><div class="line">nix-build .</div>
<div class="line"># Outputs are in ./result</div>
<div class="line"># If you get a CMake error</div>
<div class="line">rm -rf build</div>
<div class="line">nix-store --delete /nix/store/$whatever # $whatever is the derivation complaining</div>
<div class="line">nix-collect-garbage # then try again [worst case scenario]</div>
</div><!-- fragment --><h2>Leaks and performance</h2>
<p>While testing for leaks, use <code>clang</code> (for <a href="https://github.com/google/sanitizers/wiki/AddressSanitizer">AddressSanitizer</a> and <a href="https://github.com/google/sanitizers/wiki/AddressSanitizerLeakSanitizer">LeakSanitizer</a>) and the following:</p>
<div class="fragment"><div class="line"># From the developer shell</div>
<div class="line">export CXX=/usr/bin/clang++ &amp;&amp; export CC=/usr/bin/clang</div>
<div class="line">cmake .. -DCMAKE_CXX_FLAGS=&quot;-pg -fsanitize=address &quot; -DCMAKE_EXE_LINKER_FLAGS=-pg -DCMAKE_SHARED_LINKER_FLAGS=-pg</div>
</div><!-- fragment --><h1>Overview</h1>
<p>As of Mon Jan 20 15:57:18 2020, the lines of code calculated by <a href="http://cloc.sourceforge.net/">cloc</a> are as follows:</p>
<p><img src="cloc-2020-01-20_15-56.png" alt="" class="inline" title="Cloc Lines"/></p>
<h1>Contributing</h1>
<p>Please ensure that all contributions are formatted according to the <a href="./clang-format">clang-format</a> configuration file.</p>
<p>Specifically, consider using the following:</p>
<ul>
<li><a href="https://github.com/rosshemsley/SublimeClangFormat">Sublime Plugin</a> for users of Sublime Text</li>
<li><a href="https://github.com/lassik/emacs-format-all-the-code">format-all</a> for Emacs</li>
<li><a href="https://github.com/rhysd/vim-clang-format">vim-clang-format</a> for Vim</li>
<li>Visual Studio: <a href="http://llvm.org/builds/">http://llvm.org/builds/</a>, or use the <a href="https://blogs.msdn.microsoft.com/vcblog/2018/03/13/clangformat-support-in-visual-studio-2017-15-7-preview-1/">integrated support in Visual Studio 2017</a></li>
<li>Xcode: <a href="https://github.com/travisjeffery/ClangFormat-Xcode">https://github.com/travisjeffery/ClangFormat-Xcode</a></li>
</ul>
<p>Where some of the above suggestions are derived from <a href="https://github.com/andrewseidl/githook-clang-format">this depreciated githook</a>.</p>
<p>Also, do note that we have a <code>CONTRIBUTING</code> file you <b>need to read</b> to contribute, for certain reasons, like, common sense.</p>
<h2>Commit Hook</h2>
<p>Note that we expect compliance with the <code>clang-format</code> as mentioned above, and this may be enforced by using the provided scripts for a pre-commit hook: </p><div class="fragment"><div class="line">./scripts/git-pre-commit-format install</div>
</div><!-- fragment --><p>This will ensure that new commits are in accordance to the <code>clang-format</code> file.</p>
<h2>Development Builds</h2>
<p>The general idea is to drop into an interactive shell with the dependencies and then use <code>cmake</code> as usual.</p>
<div class="fragment"><div class="line">nix-shell --pure --run bash --show-trace --verbose</div>
<div class="line">cd build</div>
<div class="line">cmake .. -DCMAKE_BUILD_TYPE=Debug -DNO_WARN=TRUE \</div>
<div class="line"> -DFIND_EIGEN=TRUE \</div>
<div class="line"> -DCMAKE_EXPORT_COMPILE_COMMANDS=1 \</div>
<div class="line"> -G &quot;Ninja&quot;</div>
<div class="line">ninja</div>
<div class="line"># Test</div>
<div class="line">cd ../</div>
<div class="line">yodaStruct -c lua_inputs/config.yml</div>
<div class="line"># Debug</div>
<div class="line">gdb --args yodaStruct -c lua_inputs/config.yml</div>
</div><!-- fragment --><p> To load debugging symbols from the shared library, when you are inside <code>gdb</code> (from the top-level directory, for instance), use the following command:</p>
<div class="fragment"><div class="line">add-symbol-file build/libyodaLib.so</div>
</div><!-- fragment --><p> Then you can set breakpoints in the C++ code; for instance:</p>
<div class="fragment"><div class="line">b seams_input.cpp:408</div>
</div><!-- fragment --><h1>Acknowledgements</h1>
<p>The following tools are used in this project:</p>
<ul>
<li><a href="https://cmake.org/">CMake</a> for compilation (<a href="https://github.com/cginternals/cmake-init">cmake-init</a> was used as a reference)</li>
<li><a href="https://clang.llvm.org/">Clang</a> because it is more descriptive with better tools</li>
<li><a href="https://www.doxygen.org">Doxygen</a> for the developer API</li>
<li><a href="https://clang.llvm.org/docs/ClangFormat.html">clang-format</a> for code formatting<ul>
<li><a href="https://github.com/barisione/clang-format-hooks">clang-format-hooks</a> for <code>git</code> hooks to enforce formatting</li>
</ul>
</li>
<li><a href="https://www.lua.org">lua</a> for the scripting engine</li>
<li><a href="http://yaml.org/">yaml</a> for the configuration</li>
</ul>
<h2>Third Party Libraries</h2>
<p>The libraries used are:</p>
<ul>
<li><a href="https://github.com/bombela/backward-cpp">backward-cpp</a> for better stacktraces without <code>gdb</code></li>
<li><a href="https://github.com/jarro2783/cxxopts">cxxopts</a> for parsing command line options</li>
<li><a href="https://github.com/agauniyal/rang">rang</a> for terminal styles (ANSI)</li>
<li><a href="https://github.com/ThePhD/sol2">sol2</a> for interfacing with lua</li>
<li><a href="https://github.com/jbeder/yaml-cpp">yaml-cpp</a> for working with <code>yaml</code></li>
<li><a href="https://github.com/fmtlib/fmt">fmt</a> for safe and fast formatting</li>
<li><a href="http://www.netlib.org/lapack/">Linear Algebra PACKage (LAPACK)</a></li>
<li><a href="http://www.netlib.org/blas/">Basic Linear Algebra Subprograms (BLAS)</a></li>
<li><a href="https://github.com/yixuan/spectra/">Spectra</a></li>
<li><a href="https://www.boost.org/doc/libs/1_68_0/libs/geometry/doc/html/index.html">Boost Geometry</a> for working with different coordinates</li>
<li><a href="https://www.boost.org/doc/libs/?view=category_math">Boost Math</a> for spherical harmonics</li>
<li><a href="https://bitbucket.org/blaze-lib/blaze/">Blaze</a> for very fast modern linear algebra</li>
<li><a href="https://github.com/jlblancoc/nanoflann">nanoflann</a> to calculate nearest neighbors</li>
<li><a href="https://github.com/renatoGarcia/icecream-cpp">icecream-cpp</a> for pretty-printing and debugging </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- Copyright 2020 Rohit Goswami <rog32@hi.is>
     Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at
     http://www.apache.org/licenses/LICENSE-2.0
     Unless required by applicable law or agreed to in writing, software
     distributed under the License is distributed on an "AS IS" BASIS,
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License. -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div class="footer">
<hr class="footline"/><address class="footline"><small>
    Generated by&#160;<a href="https://www.doxygen.org/index.html">Doxygen 1.9.1</a> and the <a class="outlink" href="https://github.com/HaoZeke/doxyYoda">doxyYoda theme</a>
</small></address>
</div>
</div>
</body>
</html>
