<!-- Copyright 2020 Rohit Goswami <rog32@hi.is>
     Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at
     http://www.apache.org/licenses/LICENSE-2.0
     Unless required by applicable law or agreed to in writing, software
     distributed under the License is distributed on an "AS IS" BASIS,
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License. -->
<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>d-SEAMS: src/shapeMatch.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  },
  svg: {
    fontCache: 'global'
  }
  loader: { load: ["[tex]/unicode", "[tex]/ams"] },
  tex: {
    packages: { "[+]": ["unicode", "ams"] },
    tags: "ams",
  },
};
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>
<!-- <link href="doxygen.css" rel="stylesheet" type="text/css" /> -->
<link href="doxyYoda.min.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" >
$(document).ready(function() {
     $(".fragment").wrap("<details class='code-details'></details>");
     $(".code-details").append("<summary>Code</summary>");
 }
)
</script>
</head>
<body>
<div class="grid-contents">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<nav class="title_area">
<a class="project_logo" href="#">
<img src="dSeamsLogo.png" width="30" height="30" alt="Logo">
</a>
<span class="project_info">d-SEAMS v1.0.0</span>
</nav>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">shapeMatch.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="shapeMatch_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//-----------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// d-SEAMS - Deferred Structural Elucidation Analysis for Molecular Simulations</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// Copyright (c) 2018--present d-SEAMS core team</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// This program is free software: you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// it under the terms of the MIT License as published by</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// the Open Source Initiative.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// A copy of the MIT License is included in the LICENSE file of this repository.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// You should have received a copy of the MIT License along with this program.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// If not, see &lt;https://opensource.org/licenses/MIT&gt;.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//-----------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="shapeMatch_8hpp.html">shapeMatch.hpp</a>&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="namespacematch.html#ac4876008ba79e6b30380b4481c188407">   21</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacematch.html#ac4876008ba79e6b30380b4481c188407">match::matchPrism</a>(</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <a class="code" href="structmolSys_1_1PointCloud.html">molSys::PointCloud</a>&lt;<a class="code" href="structmolSys_1_1Point.html">molSys::Point&lt;double&gt;</a>, <span class="keywordtype">double</span>&gt; *yCloud,</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector</a>&lt;<a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int&gt;</a>&gt; nList, <span class="keyword">const</span> Eigen::MatrixXd &amp;refPoints,</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int&gt;</a> *basal1, <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int&gt;</a> *basal2,</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;double&gt;</a> *rmsdPerAtom, <span class="keywordtype">bool</span> isPerfect) {</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="keywordtype">int</span> ringSize = (*basal1).size(); <span class="comment">// Number of nodes in each basal ring</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int&gt;</a> matchedBasal1,</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;      matchedBasal2; <span class="comment">// Re-ordered basal rings 1 and 2</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="keywordtype">int</span> dim = 3;       <span class="comment">// Number of dimensions</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="comment">// Matrices for the point sets of the target basal rings</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  Eigen::MatrixXd basal1Set(ringSize,</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;                            dim); <span class="comment">// Point set for the first basal ring</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  Eigen::MatrixXd basal2Set(ringSize,</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                            dim); <span class="comment">// Point set for the second basal ring</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="keywordtype">int</span> startingIndex; <span class="comment">// Index in the basal rings from which the reference point</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;                     <span class="comment">// set is matched</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordtype">double</span> cutoffAngle = 15; <span class="comment">// Tolerance for the angular distance between the</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;                           <span class="comment">// quaternions of the basal rings</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordtype">double</span> angDist; <span class="comment">// Calculated angular distance between the two basal rings</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="comment">// Variables for the absolute orientation</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;double&gt;</a> quat1, quat2; <span class="comment">// quaternion rotation</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordtype">double</span> rmsd1, rmsd2;              <span class="comment">// least total RMSD</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;double&gt;</a> rmsdList1,</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      rmsdList2;         <span class="comment">// List of RMSD per atom in the order fed in</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="keywordtype">double</span> scale1, scale2; <span class="comment">// Scale factor</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="comment">// Deformed block classification</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordtype">bool</span> doAngleCriterion = <span class="keyword">false</span>; <span class="comment">// For deformed blocks</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="comment">// -----------------------</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="comment">// Getting the target Eigen vectors</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="comment">// Get the re-ordered matched basal rings, ordered with respect to each other</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <a class="code" href="namespacepntToPnt.html#a9e26156fea9f39958302a4c95d00797e">pntToPnt::relOrderPrismBlock</a>(yCloud, *basal1, *basal2, nList, &amp;matchedBasal1,</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                               &amp;matchedBasal2);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="comment">// -----------------------</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="comment">// Match the basal rings with a complete prism block, given the relatively</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="comment">// ordered basal rings This actually only needs to be done for deformed prism</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="comment">// blocks</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keywordtype">bool</span> blockMatch = <a class="code" href="namespacematch.html#a1c4e7dab30fe0bdb029c2996dc80882a">match::matchPrismBlock</a>(</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      yCloud, nList, refPoints, &amp;matchedBasal1, &amp;matchedBasal2, &amp;startingIndex);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="comment">// -----------------------</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="comment">// Check for deformed prisms</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keywordflow">if</span> (!isPerfect) {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordflow">if</span> (!blockMatch) {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      <span class="keywordflow">return</span> blockMatch;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    }</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  }</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="comment">// If the deformed prism does not fulfil the shape matching criterion, then do</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="comment">// not calculate the RMSD per atom</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="comment">// -----------------------</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="comment">// Section for RMSD per atom, based on basal ring matching</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  basal1Set =</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      <a class="code" href="namespacepntToPnt.html#a468a3864d5ebed50594501666028c244">pntToPnt::fillPointSetPrismRing</a>(yCloud, matchedBasal1, startingIndex);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="comment">// Fill up the point set for basal2</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  basal2Set =</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      <a class="code" href="namespacepntToPnt.html#a468a3864d5ebed50594501666028c244">pntToPnt::fillPointSetPrismRing</a>(yCloud, matchedBasal2, startingIndex);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="comment">// Use Horn&#39;s algorithm to calculate the absolute orientation and RMSD etc.</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <a class="code" href="namespaceabsor.html#ad4f0741af9784817b44df6883888d9a3">absor::hornAbsOrientation</a>(refPoints, basal1Set, &amp;quat1, &amp;rmsd1, &amp;rmsdList1,</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                            &amp;scale1); <span class="comment">// basal1</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <a class="code" href="namespaceabsor.html#ad4f0741af9784817b44df6883888d9a3">absor::hornAbsOrientation</a>(refPoints, basal2Set, &amp;quat2, &amp;rmsd2, &amp;rmsdList2,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                            &amp;scale2); <span class="comment">// basal2</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="comment">// // ------------</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="comment">// // Update the per-atom RMSD for each particle</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">// // Basal1</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="comment">// match::updatePerAtomRMSDRing(matchedBasal1, startingIndex, rmsdList1,</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="comment">//                              rmsdPerAtom);</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="comment">// // Basal2</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="comment">// match::updatePerAtomRMSDRing(matchedBasal2, startingIndex, rmsdList2,</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="comment">//                              rmsdPerAtom);</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="comment">// // ------------</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="comment">// ------------</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="comment">// Update the RMSD (obtained for each ring) for each particle</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="comment">// Basal1</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <a class="code" href="namespacematch.html#a75215687da1125d0fd37ba71f8ee18ff">match::updateRMSDRing</a>(matchedBasal1, startingIndex, rmsd1, rmsdPerAtom);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="comment">// Basal2</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <a class="code" href="namespacematch.html#a75215687da1125d0fd37ba71f8ee18ff">match::updateRMSDRing</a>(matchedBasal2, startingIndex, rmsd2, rmsdPerAtom);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="comment">// ------------</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;} <span class="comment">// end of function</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="namespacematch.html#a64b2b2b69cffbaf8ae93583588c63240">  110</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacematch.html#a64b2b2b69cffbaf8ae93583588c63240">match::matchUntetheredPrism</a>(</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <a class="code" href="structmolSys_1_1PointCloud.html">molSys::PointCloud</a>&lt;<a class="code" href="structmolSys_1_1Point.html">molSys::Point&lt;double&gt;</a>, <span class="keywordtype">double</span>&gt; *yCloud,</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector</a>&lt;<a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int&gt;</a>&gt; nList, <span class="keyword">const</span> Eigen::MatrixXd &amp;refPoints,</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int&gt;</a> *basal1, <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int&gt;</a> *basal2,</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;double&gt;</a> *rmsdPerAtom) {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordtype">int</span> ringSize = (*basal1).size(); <span class="comment">// Number of nodes in each basal ring</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int&gt;</a> matchedBasal1,</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      matchedBasal2; <span class="comment">// Re-ordered basal rings 1 and 2</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="keywordtype">int</span> dim = 3;       <span class="comment">// Number of dimensions</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="comment">// Matrices for the point sets of the target basal rings</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  Eigen::MatrixXd basal1Set(ringSize,</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                            dim); <span class="comment">// Point set for the first basal ring</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  Eigen::MatrixXd basal2Set(ringSize,</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                            dim); <span class="comment">// Point set for the second basal ring</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="keywordtype">int</span> startingIndex; <span class="comment">// Index in the basal rings from which the reference point</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                     <span class="comment">// set is matched</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordtype">double</span> angDist;    <span class="comment">// Calculated angular distance between the two basal rings</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="comment">// Variables for the absolute orientation</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;double&gt;</a> quat1, quat2; <span class="comment">// quaternion rotation</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="keywordtype">double</span> rmsd1, rmsd2;              <span class="comment">// least total RMSD</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;double&gt;</a> rmsdList1,</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      rmsdList2;         <span class="comment">// List of RMSD per atom in the order fed in</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordtype">double</span> scale1, scale2; <span class="comment">// Scale factor</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="comment">// Deformed block classification</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="keywordtype">bool</span> doAngleCriterion = <span class="keyword">false</span>; <span class="comment">// For deformed blocks</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="comment">// Getting the target Eigen vectors</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="comment">// Get the re-ordered matched basal rings, ordered with respect to each other</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <a class="code" href="namespacepntToPnt.html#a9e26156fea9f39958302a4c95d00797e">pntToPnt::relOrderPrismBlock</a>(yCloud, *basal1, *basal2, &amp;matchedBasal1,</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                               &amp;matchedBasal2);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="comment">// -----------------------</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="comment">// Match the basal rings with a complete prism block, given the relatively</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="comment">// ordered basal rings This actually only needs to be done for deformed prism</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="comment">// blocks</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordtype">bool</span> blockMatch = <a class="code" href="namespacematch.html#a1c4e7dab30fe0bdb029c2996dc80882a">match::matchPrismBlock</a>(</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      yCloud, nList, refPoints, &amp;matchedBasal1, &amp;matchedBasal2, &amp;startingIndex);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="comment">// -----------------------</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="comment">// Check to see if the prism matches the reference prism block</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="keywordflow">if</span> (!blockMatch) {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordflow">return</span> blockMatch;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="comment">// If the deformed prism does not fulfil the shape matching criterion, then do</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="comment">// not calculate the RMSD per atom</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="comment">// -----------------------</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="comment">// Section for RMSD per atom, based on basal ring matching</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  basal1Set =</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <a class="code" href="namespacepntToPnt.html#a468a3864d5ebed50594501666028c244">pntToPnt::fillPointSetPrismRing</a>(yCloud, matchedBasal1, startingIndex);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="comment">// Fill up the point set for basal2</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  basal2Set =</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <a class="code" href="namespacepntToPnt.html#a468a3864d5ebed50594501666028c244">pntToPnt::fillPointSetPrismRing</a>(yCloud, matchedBasal2, startingIndex);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="comment">// Use Horn&#39;s algorithm to calculate the absolute orientation and RMSD etc.</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <a class="code" href="namespaceabsor.html#ad4f0741af9784817b44df6883888d9a3">absor::hornAbsOrientation</a>(refPoints, basal1Set, &amp;quat1, &amp;rmsd1, &amp;rmsdList1,</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                            &amp;scale1); <span class="comment">// basal1</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <a class="code" href="namespaceabsor.html#ad4f0741af9784817b44df6883888d9a3">absor::hornAbsOrientation</a>(refPoints, basal2Set, &amp;quat2, &amp;rmsd2, &amp;rmsdList2,</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                            &amp;scale2); <span class="comment">// basal2</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="comment">// // Calculate the angular distance between basal1 and basal2</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="comment">// angDist = gen::angDistDegQuaternions(quat1, quat2);</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="comment">// // Check if the shapes are aligned</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="comment">// if (angDist &gt; cutoffAngle) {</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="comment">//   return false;</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="comment">// } // If not aligned, it is not a prism block</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="comment">// ------------</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="comment">// Update the RMSD (obtained for each ring) for each particle</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="comment">// Basal1</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <a class="code" href="namespacematch.html#a75215687da1125d0fd37ba71f8ee18ff">match::updateRMSDRing</a>(matchedBasal1, startingIndex, rmsd1, rmsdPerAtom);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="comment">// Basal2</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <a class="code" href="namespacematch.html#a75215687da1125d0fd37ba71f8ee18ff">match::updateRMSDRing</a>(matchedBasal2, startingIndex, rmsd2, rmsdPerAtom);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="comment">// ------------</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;} <span class="comment">// end of function</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00186"></a><span class="lineno"><a class="line" href="namespacematch.html#a5f6e8b6479e09ce7ed9e602b24b6ddfe">  186</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="namespacematch.html#a5f6e8b6479e09ce7ed9e602b24b6ddfe">match::updatePerAtomRMSDRing</a>(<a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int&gt;</a> basalRing, <span class="keywordtype">int</span> startingIndex,</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                                 <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;double&gt;</a> rmsdFromMatch,</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                                 <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;double&gt;</a> *rmsdPerAtom) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keywordtype">int</span> atomIndex;                   <span class="comment">// Atom particle index, in rmsdPerAtom</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="keywordtype">int</span> ringSize = basalRing.<a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector/size.html">size</a>(); <span class="comment">// Size of the basal ring</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordtype">int</span> index;                       <span class="comment">// Corresponding index in the basal ring</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keywordtype">double</span> iRMSD;                    <span class="comment">// Per-particle RMSD</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160; </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="comment">// -----------------</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="comment">// Update the RMSD per particle</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; ringSize; i++) {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    index = i + startingIndex; <span class="comment">// Corresponding index in the basal ring</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="comment">// Wrap-around</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keywordflow">if</span> (index &gt;= ringSize) {</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      index -= ringSize;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    } <span class="comment">// end of wrap-around</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">// Get the atom index</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    atomIndex = basalRing[index];</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">// Get and update the RMSD per particle</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    iRMSD = rmsdFromMatch[i];</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">if</span> ((*rmsdPerAtom)[atomIndex] == -1) {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      (*rmsdPerAtom)[atomIndex] = iRMSD;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    } <span class="comment">// end of update of RMSD</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  } <span class="comment">// end of updating the RMSD per particle</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="comment">// -----------------</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="comment">// finito</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;} <span class="comment">// end of function</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno"><a class="line" href="namespacematch.html#a75215687da1125d0fd37ba71f8ee18ff">  220</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="namespacematch.html#a75215687da1125d0fd37ba71f8ee18ff">match::updateRMSDRing</a>(<a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int&gt;</a> basalRing, <span class="keywordtype">int</span> startingIndex,</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                          <span class="keywordtype">double</span> rmsdVal, <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;double&gt;</a> *rmsdPerAtom) {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="keywordtype">int</span> atomIndex;                   <span class="comment">// Atom particle index, in rmsdPerAtom</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="keywordtype">int</span> ringSize = basalRing.<a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector/size.html">size</a>(); <span class="comment">// Size of the basal ring</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordtype">int</span> index;                       <span class="comment">// Corresponding index in the basal ring</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="comment">// -----------------</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="comment">// Update the RMSD per particle</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; ringSize; i++) {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    index = i + startingIndex; <span class="comment">// Corresponding index in the basal ring</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">// Wrap-around</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">if</span> (index &gt;= ringSize) {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      index -= ringSize;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    } <span class="comment">// end of wrap-around</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">// Get the atom index</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    atomIndex = basalRing[index];</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment">// The RMSD value to update with is rmsdVal</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">if</span> ((*rmsdPerAtom)[atomIndex] == -1) {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      (*rmsdPerAtom)[atomIndex] = rmsdVal;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    } <span class="comment">// end of update of RMSD</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  } <span class="comment">// end of updating the RMSD for each particle</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="comment">// -----------------</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="comment">// finito</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;} <span class="comment">// end of function</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="namespacematch.html#a1c4e7dab30fe0bdb029c2996dc80882a">  251</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacematch.html#a1c4e7dab30fe0bdb029c2996dc80882a">match::matchPrismBlock</a>(</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <a class="code" href="structmolSys_1_1PointCloud.html">molSys::PointCloud</a>&lt;<a class="code" href="structmolSys_1_1Point.html">molSys::Point&lt;double&gt;</a>, <span class="keywordtype">double</span>&gt; *yCloud,</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector</a>&lt;<a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int&gt;</a>&gt; nList, <span class="keyword">const</span> Eigen::MatrixXd &amp;refPoints,</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int&gt;</a> *basal1, <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int&gt;</a> *basal2, <span class="keywordtype">int</span> *beginIndex) {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="keywordtype">int</span> ringSize = (*basal1).size(); <span class="comment">// Number of nodes in the basal rings</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="keywordtype">bool</span> isMatch; <span class="comment">// Qualifier for whether the prism block matches or not</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keywordtype">int</span> dim = 3;  <span class="comment">// Number of dimensions</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="keywordtype">int</span> nop = 2 * ringSize; <span class="comment">// Number of particles in the prism block</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  Eigen::MatrixXd refPrismBlock(</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      nop, dim); <span class="comment">// eigen matrix for the reference prism block</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  Eigen::MatrixXd targetPrismBlock(</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      nop, dim);     <span class="comment">// eigen matrix for the target prism block</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordtype">int</span> startingIndex; <span class="comment">// Index from which the basal rings will be ordered</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                     <span class="comment">// (permutations)</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="comment">// variables for shape-matching</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;double&gt;</a> quat;     <span class="comment">// Quaternion for the rotation</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordtype">double</span> rmsd;                  <span class="comment">// RMSD value for the entire shape</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;double&gt;</a> rmsdList; <span class="comment">// RMSD value for each point</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="keywordtype">double</span> scale;                 <span class="comment">// Scale factor</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="comment">// ----------------------------------------------------</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="comment">// Get the reference prism block</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  refPrismBlock =</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <a class="code" href="namespacepntToPnt.html#a7e80d4e9ce192f1a20cdea501f4b9f6f">pntToPnt::createPrismBlock</a>(yCloud, refPoints, ringSize, *basal1, *basal2);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="comment">// ----------------------------------------------------</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160; </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="comment">// Loop through possible point-to-point correspondences</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordflow">if</span> (ringSize % 2 == 0 || ringSize == 3) {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    startingIndex = 0;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="comment">// Fill up the point set for the target prism block</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    targetPrismBlock =</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <a class="code" href="namespacepntToPnt.html#ac1fc4d1ca64de4e2ed5e13931cc8a9e3">pntToPnt::fillPointSetPrismBlock</a>(yCloud, *basal1, *basal2, 0);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">// Shape-matching</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <a class="code" href="namespaceabsor.html#ad4f0741af9784817b44df6883888d9a3">absor::hornAbsOrientation</a>(refPrismBlock, targetPrismBlock, &amp;quat, &amp;rmsd,</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                              &amp;rmsdList,</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                              &amp;scale); <span class="comment">// basal2</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  }                                    <span class="comment">// even or if there are 3 nodes</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="comment">// Define the vector, RMSD etc:</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;double&gt;</a> currentQuat; <span class="comment">// quaternion rotation</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordtype">double</span> currentRmsd;              <span class="comment">// least total RMSD</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;double&gt;</a></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        currentRmsdList; <span class="comment">// List of RMSD per atom in the order fed in</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordtype">double</span> currentScale;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="comment">// Loop through all possible startingIndex</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; ringSize; i++) {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <span class="comment">// Fill up the point set for basal1</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      targetPrismBlock =</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;          <a class="code" href="namespacepntToPnt.html#ac1fc4d1ca64de4e2ed5e13931cc8a9e3">pntToPnt::fillPointSetPrismBlock</a>(yCloud, *basal1, *basal2, i);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="comment">// Use Horn&#39;s algorithm to calculate the absolute orientation and RMSD</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <span class="comment">// etc. for basal1</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <a class="code" href="namespaceabsor.html#ad4f0741af9784817b44df6883888d9a3">absor::hornAbsOrientation</a>(refPrismBlock, targetPrismBlock, &amp;currentQuat,</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                                &amp;currentRmsd, &amp;currentRmsdList, &amp;currentScale);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="comment">// Comparison to get the least RMSD for the correct mapping</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      <span class="keywordflow">if</span> (i == 0) {</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="comment">// Init</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        quat = currentQuat;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        rmsd = currentRmsd;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        rmsdList = currentRmsdList;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        scale = currentScale;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        startingIndex = i;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      } <span class="comment">// init</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="comment">// Check to see if the calculated RMSD is less than the RMSD already</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="comment">// saved</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="keywordflow">if</span> (currentRmsd &lt; rmsd) {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;          quat = currentQuat;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;          rmsd = currentRmsd;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;          rmsdList = currentRmsdList;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;          scale = currentScale;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;          startingIndex = i;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        } <span class="comment">// end of check to see if the current RMSD is smaller</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      }   <span class="comment">// end of comparison and filling</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    }     <span class="comment">// end of loop through startingIndex</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  }       <span class="comment">// ringSize is odd, so every point must be tried</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="comment">// Update the index from which matching is started</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  *beginIndex = startingIndex;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="comment">// // TEST DELETE BLOCK LATER</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="comment">// if (ringSize == 6) {</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="comment">//   std::fstream rmsdFile;</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="comment">//   rmsdFile.open(&quot;../runOne/topoINT/rmsd6.dat&quot;,</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="comment">//                 std::fstream::in | std::fstream::out | std::fstream::app);</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="comment">//   rmsdFile &lt;&lt; rmsd &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="comment">//   rmsdFile.close();</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="comment">// } else if (ringSize == 4) {</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="comment">//   std::fstream rmsdFile;</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="comment">//   rmsdFile.open(&quot;../runOne/topoINT/rmsd4.dat&quot;,</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="comment">//                 std::fstream::in | std::fstream::out | std::fstream::app);</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="comment">//   rmsdFile &lt;&lt; rmsd &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="comment">//   rmsdFile.close();</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="comment">// }</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="comment">// // END OF BLOCK TO BE DELETED</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160; </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="comment">// Condition for shape-matching</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keywordflow">if</span> (rmsd &lt;= 6) {</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    isMatch = <span class="keyword">true</span>; <span class="comment">// Is a prism block</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  }                 <span class="comment">// within RMSD range</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    isMatch = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  }</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160; </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="comment">// Return</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keywordflow">return</span> isMatch;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;}</div>
<div class="ttc" id="anamespaceabsor_html_ad4f0741af9784817b44df6883888d9a3"><div class="ttname"><a href="namespaceabsor.html#ad4f0741af9784817b44df6883888d9a3">absor::hornAbsOrientation</a></div><div class="ttdeci">int hornAbsOrientation(const Eigen::MatrixXd &amp;refPoints, const Eigen::MatrixXd &amp;targetPoints, std::vector&lt; double &gt; *quat, double *rmsd, std::vector&lt; double &gt; *rmsdList, double *scale)</div><div class="ttdoc">Get the absolute orientation using Horn's algorithm (with quaternions)</div><div class="ttdef"><b>Definition:</b> <a href="absOrientation_8cpp_source.html#l00030">absOrientation.cpp:30</a></div></div>
<div class="ttc" id="anamespacematch_html_a1c4e7dab30fe0bdb029c2996dc80882a"><div class="ttname"><a href="namespacematch.html#a1c4e7dab30fe0bdb029c2996dc80882a">match::matchPrismBlock</a></div><div class="ttdeci">bool matchPrismBlock(molSys::PointCloud&lt; molSys::Point&lt; double &gt;, double &gt; *yCloud, std::vector&lt; std::vector&lt; int &gt;&gt; nList, const Eigen::MatrixXd &amp;refPoints, std::vector&lt; int &gt; *basal1, std::vector&lt; int &gt; *basal2, int *beginIndex)</div><div class="ttdef"><b>Definition:</b> <a href="shapeMatch_8cpp_source.html#l00251">shapeMatch.cpp:251</a></div></div>
<div class="ttc" id="anamespacematch_html_a5f6e8b6479e09ce7ed9e602b24b6ddfe"><div class="ttname"><a href="namespacematch.html#a5f6e8b6479e09ce7ed9e602b24b6ddfe">match::updatePerAtomRMSDRing</a></div><div class="ttdeci">int updatePerAtomRMSDRing(std::vector&lt; int &gt; basalRing, int startingIndex, std::vector&lt; double &gt; rmsdFromMatch, std::vector&lt; double &gt; *rmsdPerAtom)</div><div class="ttdoc">Update the per-particle RMSD for a prism block basal ring.</div><div class="ttdef"><b>Definition:</b> <a href="shapeMatch_8cpp_source.html#l00186">shapeMatch.cpp:186</a></div></div>
<div class="ttc" id="anamespacematch_html_a64b2b2b69cffbaf8ae93583588c63240"><div class="ttname"><a href="namespacematch.html#a64b2b2b69cffbaf8ae93583588c63240">match::matchUntetheredPrism</a></div><div class="ttdeci">bool matchUntetheredPrism(molSys::PointCloud&lt; molSys::Point&lt; double &gt;, double &gt; *yCloud, std::vector&lt; std::vector&lt; int &gt;&gt; nList, const Eigen::MatrixXd &amp;refPoints, std::vector&lt; int &gt; *basal1, std::vector&lt; int &gt; *basal2, std::vector&lt; double &gt; *rmsdPerAtom)</div><div class="ttdef"><b>Definition:</b> <a href="shapeMatch_8cpp_source.html#l00110">shapeMatch.cpp:110</a></div></div>
<div class="ttc" id="anamespacematch_html_a75215687da1125d0fd37ba71f8ee18ff"><div class="ttname"><a href="namespacematch.html#a75215687da1125d0fd37ba71f8ee18ff">match::updateRMSDRing</a></div><div class="ttdeci">int updateRMSDRing(std::vector&lt; int &gt; basalRing, int startingIndex, double rmsdVal, std::vector&lt; double &gt; *rmsdPerAtom)</div><div class="ttdef"><b>Definition:</b> <a href="shapeMatch_8cpp_source.html#l00220">shapeMatch.cpp:220</a></div></div>
<div class="ttc" id="anamespacematch_html_ac4876008ba79e6b30380b4481c188407"><div class="ttname"><a href="namespacematch.html#ac4876008ba79e6b30380b4481c188407">match::matchPrism</a></div><div class="ttdeci">bool matchPrism(molSys::PointCloud&lt; molSys::Point&lt; double &gt;, double &gt; *yCloud, std::vector&lt; std::vector&lt; int &gt;&gt; nList, const Eigen::MatrixXd &amp;refPoints, std::vector&lt; int &gt; *basal1, std::vector&lt; int &gt; *basal2, std::vector&lt; double &gt; *rmsdPerAtom, bool isPerfect=true)</div><div class="ttdef"><b>Definition:</b> <a href="shapeMatch_8cpp_source.html#l00021">shapeMatch.cpp:21</a></div></div>
<div class="ttc" id="anamespacepntToPnt_html_a468a3864d5ebed50594501666028c244"><div class="ttname"><a href="namespacepntToPnt.html#a468a3864d5ebed50594501666028c244">pntToPnt::fillPointSetPrismRing</a></div><div class="ttdeci">Eigen::MatrixXd fillPointSetPrismRing(molSys::PointCloud&lt; molSys::Point&lt; double &gt;, double &gt; *yCloud, std::vector&lt; int &gt; basalRing, int startingIndex)</div><div class="ttdef"><b>Definition:</b> <a href="pntCorrespondence_8cpp_source.html#l00464">pntCorrespondence.cpp:464</a></div></div>
<div class="ttc" id="anamespacepntToPnt_html_a7e80d4e9ce192f1a20cdea501f4b9f6f"><div class="ttname"><a href="namespacepntToPnt.html#a7e80d4e9ce192f1a20cdea501f4b9f6f">pntToPnt::createPrismBlock</a></div><div class="ttdeci">Eigen::MatrixXd createPrismBlock(molSys::PointCloud&lt; molSys::Point&lt; double &gt;, double &gt; *yCloud, const Eigen::MatrixXd &amp;refPoints, int ringSize, std::vector&lt; int &gt; basal1, std::vector&lt; int &gt; basal2)</div><div class="ttdef"><b>Definition:</b> <a href="pntCorrespondence_8cpp_source.html#l00056">pntCorrespondence.cpp:56</a></div></div>
<div class="ttc" id="anamespacepntToPnt_html_a9e26156fea9f39958302a4c95d00797e"><div class="ttname"><a href="namespacepntToPnt.html#a9e26156fea9f39958302a4c95d00797e">pntToPnt::relOrderPrismBlock</a></div><div class="ttdeci">int relOrderPrismBlock(molSys::PointCloud&lt; molSys::Point&lt; double &gt;, double &gt; *yCloud, std::vector&lt; int &gt; basal1, std::vector&lt; int &gt; basal2, std::vector&lt; std::vector&lt; int &gt;&gt; nList, std::vector&lt; int &gt; *outBasal1, std::vector&lt; int &gt; *outBasal2)</div><div class="ttdef"><b>Definition:</b> <a href="pntCorrespondence_8cpp_source.html#l00207">pntCorrespondence.cpp:207</a></div></div>
<div class="ttc" id="anamespacepntToPnt_html_ac1fc4d1ca64de4e2ed5e13931cc8a9e3"><div class="ttname"><a href="namespacepntToPnt.html#ac1fc4d1ca64de4e2ed5e13931cc8a9e3">pntToPnt::fillPointSetPrismBlock</a></div><div class="ttdeci">Eigen::MatrixXd fillPointSetPrismBlock(molSys::PointCloud&lt; molSys::Point&lt; double &gt;, double &gt; *yCloud, std::vector&lt; int &gt; basal1, std::vector&lt; int &gt; basal2, int startingIndex)</div><div class="ttdef"><b>Definition:</b> <a href="pntCorrespondence_8cpp_source.html#l00508">pntCorrespondence.cpp:508</a></div></div>
<div class="ttc" id="ashapeMatch_8hpp_html"><div class="ttname"><a href="shapeMatch_8hpp.html">shapeMatch.hpp</a></div></div>
<div class="ttc" id="asize_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/container/vector/size.html">std::vector::size</a></div><div class="ttdeci">T size(T... args)</div></div>
<div class="ttc" id="astructmolSys_1_1PointCloud_html"><div class="ttname"><a href="structmolSys_1_1PointCloud.html">molSys::PointCloud</a></div><div class="ttdoc">This contains a collection of points; contains information for a particular frame.</div><div class="ttdef"><b>Definition:</b> <a href="mol__sys_8hpp_source.html#l00170">mol_sys.hpp:170</a></div></div>
<div class="ttc" id="astructmolSys_1_1Point_html"><div class="ttname"><a href="structmolSys_1_1Point.html">molSys::Point</a></div><div class="ttdoc">This contains per-particle information.</div><div class="ttdef"><b>Definition:</b> <a href="mol__sys_8hpp_source.html#l00149">mol_sys.hpp:149</a></div></div>
<div class="ttc" id="avector_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- Copyright 2020 Rohit Goswami <rog32@hi.is>
     Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at
     http://www.apache.org/licenses/LICENSE-2.0
     Unless required by applicable law or agreed to in writing, software
     distributed under the License is distributed on an "AS IS" BASIS,
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License. -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div class="footer">
<hr class="footline"/><address class="footline"><small>
    Generated by&#160;<a href="https://www.doxygen.org/index.html">Doxygen 1.9.1</a> and the <a class="outlink" href="https://github.com/HaoZeke/doxyYoda">doxyYoda theme</a>
</small></address>
</div>
</div>
</body>
</html>
